detect:
  log type: wel
  op: and
  rules:
  - case sensitive: false
    op: is
    path: Event/System/EventID
    value: '11'
  - op: or
    rules:
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-DllInjection.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-WmiCommand.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-GPPPassword.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-Keystrokes.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-VaultCredential.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-CredentialInjection.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-Mimikatz.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-NinjaCopy.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-TokenManipulation.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Out-Minidump.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \VolumeShadowCopyTools.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-ReflectivePEInjection.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-TimedScreenshot.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-UserHunter.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Find-GPOLocation.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-ACLScanner.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-DowngradeAccount.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-ServiceUnquoted.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-ServiceFilePermission.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-ServicePermission.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-ServiceAbuse.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Install-ServiceBinary.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-RegAutoLogon.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-VulnAutoRun.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-VulnSchTask.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-UnattendedInstallFile.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-WebConfig.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-ApplicationHost.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-RegAlwaysInstallElevated.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-Unconstrained.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Add-RegBackdoor.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Add-ScrnSaveBackdoor.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Gupt-Backdoor.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-ADSBackdoor.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Enabled-DuplicateToken.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-PsUaCme.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Remove-Update.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Check-VM.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-LSASecret.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-PassHashes.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Show-TargetScreen.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Port-Scan.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-PoshRatHttp.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-PowerShellTCP.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-PowerShellWMI.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Add-Exfiltration.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Add-Persistence.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Do-Exfiltration.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Start-CaptureServer.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-ShellCode.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-ChromeDump.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-ClipboardContents.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-FoxDump.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-IndexedItem.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-Screenshot.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-Inveigh.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-NetRipper.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-EgressCheck.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-PostExfil.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-PSInject.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-RunAs.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \MailRaider.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \New-HoneyHash.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Set-MacAttribute.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-DCSync.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-PowerDump.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Exploit-Jboss.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-ThunderStruck.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-VoiceTroll.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Set-Wallpaper.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-InveighRelay.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-PsExec.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-SSHCommand.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-SecurityPackages.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Install-SSP.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-BackdoorLNK.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \PowerBreach.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-SiteListPassword.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-System.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-BypassUAC.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-Tater.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-WScriptBypassUAC.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \PowerUp.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \PowerView.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Get-RickAstley.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Find-Fruit.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \HTTP-Login.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Find-TrustedDocuments.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-Paranoia.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-WinEnum.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-ARPScan.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-PortScan.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-ReverseDNSLookup.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-SMBScanner.ps1
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetFilename
      value: \Invoke-Mimikittenz.ps1
  target: log
respond:
- action: report
  metadata:
    author: Markus Neis
    description: Detects the creation of known powershell scripts for exploitation
    level: high
    references:
    - https://raw.githubusercontent.com/Neo23x0/sigma/f35c50049fa896dff91ff545cb199319172701e8/rules/windows/powershell/powershell_malicious_commandlets.yml
    tags:
    - attack.execution
    - attack.t1086
  name: Malicious PowerShell Commandlet Names

